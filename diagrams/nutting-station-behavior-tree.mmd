graph TD

    %% Station Login Phase
    %% Workorder Selection Phase
    %% Main Action Screen with Operation Branches
    %% Load Inventory to Station Action
    %% Combine Inventory Action
    %% Return Inventory Action (from Action Screen)
    %% Change Workorder Action
    %% Logout Action
    %% Styling

    %% Node Definitions

    ActionScreen["ğŸ¯ Action Screen<br/>Hub for All Operations"]
    Root["ğŸŒ³ Nutting Station Behavior Tree"]
    SubmitCombine["Submit Combine to API"]

    %% Connections

    Action -->|Load Inventory<br/>to Station| LoadInventory["ğŸ“¬ Load Inventory<br/>Enter/Scan Container ID"]
    Action -->|Combine Inventory| CombineDialog["ğŸ“ Combine Dialog<br/>Select Containers<br/>Set Quality"]
    Action -->|Change Workorder| CallUnreserve["ğŸ“ Call unreserveWorkorder()<br/>API Endpoint"]
    Action -->|Logout| LogoutConfirm["ğŸšª Confirm Logout?"]
    ActionScreen --> Action{Select<br/>Action}
    AddToInventory[Submit Load Inventory to API] --> LoadInventory
    CallSelectWO --> Refresh
    CallUnreserve --> Refresh
    CheckWOExists -->|No| SelectWO
    CheckWOExists -->|Yes| ActionScreen
    CheckWOSelected -->|No| SelectWO["ğŸ“‹ Select Workorder<br/>Sales/Stock Tabs<br/>Only Clickable: Compatible WOs"]
    CheckWOSelected -->|Yes| CheckWOExists{Selected WO<br/>Still Exists?}
    CombineDialog --> SubmitCombine
    CombineDialog -->|Return| ActionScreen
    ExecuteLogout[Submit logout to the API] --> StationLogin
    LoadInventory --> AddToInventory
    LoadInventory -->|Return| ActionScreen
    LogoutConfirm -->|Cancel| ActionScreen
    LogoutConfirm -->|Confirm| ExecuteLogout["ğŸ”“ Clear Session<br/>Reset State"]
    Refresh --> CheckWOSelected{Workorder<br/>Selected?}
    ReturnFromWOList --> ReturnSubmit["ğŸ“¥ Submit Return<br/>to API"]
    ReturnSubmit --> Refresh
    Root --> StationLogin["ğŸ” Station Login<br/>Select Station"]
    SelectWO --> WOAction{User<br/>Action?}
    StationLogin --> Refresh["Get Station Info"]
    SubmitCombine --> CombineDialog
    WOAction -->|Select Workorder| CallSelectWO["ğŸ“ Call selectWorkorder()<br/>API Endpoint"]
    WOAction -->|Return Station<br/>Inventory| ReturnFromWOList["ğŸ“ Return Screen<br/>Select Containers<br/>Enter Total Containers<br/>Enter Qty per Container"]

    %% Styles

    style Action fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style ActionScreen fill:#e1f5e1,stroke:#388e3c,stroke-width:3px
    style AddToInventory fill:#f1f8e9,stroke:#558b2f
    style CallSelectWO fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    style CallUnreserve fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    style CheckWOExists fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style CheckWOSelected fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style CombineDialog fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    style ExecuteLogout fill:#f1f8e9,stroke:#558b2f
    style LoadInventory fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    style LogoutConfirm fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style Refresh fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    style ReturnFromWOList fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    style ReturnSubmit fill:#f1f8e9,stroke:#558b2f
    style Root fill:#e1f5e1,stroke:#388e3c,stroke-width:3px
    style SelectWO fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    style StationLogin fill:#e3f2fd,stroke:#1976d2,stroke-width:3px
    style WOAction fill:#fff3e0,stroke:#f57c00,stroke-width:2px