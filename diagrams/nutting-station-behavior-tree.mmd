graph TD
    Root["ğŸŒ³ Nutting Station Behavior Tree"]

    %% Station Login Phase
    Root --> StationLogin["ğŸ” Station Login<br/>Select Station"]


    Refresh --> CheckWOSelected{Workorder<br/>Selected?}

    %% Workorder Selection Phase
    CheckWOSelected -->|No| SelectWO["ğŸ“‹ Select Workorder<br/>Sales/Stock Tabs<br/>Only Clickable: Compatible WOs"]
    CheckWOSelected -->|Yes| CheckWOExists{Selected WO<br/>Still Exists?}

    CheckWOExists -->|No| SelectWO

    SelectWO --> WOAction{User<br/>Action?}

    WOAction -->|Select Workorder| CallSelectWO["ğŸ“ Call selectWorkorder()<br/>API Endpoint"]


    WOAction -->|Return Station<br/>Inventory| ReturnFromWOList["ğŸ“ Return Screen<br/>Select Containers<br/>Enter Total Containers<br/>Enter Qty per Container"]
    ReturnFromWOList --> ReturnSubmit["ğŸ“¥ Submit Return<br/>to API"]

    ActionScreen["ğŸ¯ Action Screen<br/>Hub for All Operations"]
    CheckWOExists -->|Yes| ActionScreen

    %% Main Action Screen with Operation Branches
    ActionScreen --> Action{Select<br/>Action}

    %% Load Inventory to Station Action
    Action -->|Load Inventory<br/>to Station| LoadInventory["ğŸ“¬ Load Inventory<br/>Enter/Scan Container ID"]
    AddToInventory[Submit Load Inventory to API] --> LoadInventory

    %% Combine Inventory Action
    Action -->|Combine Inventory| CombineDialog["ğŸ“ Combine Dialog<br/>Select Containers<br/>Set Quality"]

    %% Return Inventory Action (from Action Screen)

    %% Change Workorder Action
    Action -->|Change Workorder| CallUnreserve["ğŸ“ Call unreserveWorkorder()<br/>API Endpoint"]

    %% Logout Action
    Action -->|Logout| LogoutConfirm["ğŸšª Confirm Logout?"]
    LogoutConfirm -->|Cancel| ActionScreen
    LogoutConfirm -->|Confirm| ExecuteLogout["ğŸ”“ Clear Session<br/>Reset State"]
    ExecuteLogout[Submit logout to the API] --> StationLogin

    %% Styling
    style Root fill:#e1f5e1,stroke:#388e3c,stroke-width:3px
    style StationLogin fill:#e3f2fd,stroke:#1976d2,stroke-width:3px
    style Refresh fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    style CheckWOSelected fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style CheckWOExists fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style SelectWO fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    style WOAction fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style CallSelectWO fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    style ActionScreen fill:#e1f5e1,stroke:#388e3c,stroke-width:3px
    style Action fill:#fff3e0,stroke:#f57c00,stroke-width:2px

    style LoadInventory fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    style AddToInventory fill:#f1f8e9,stroke:#558b2f

    style CombineDialog fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px

    style ReturnFromWOList fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    style ReturnSubmit fill:#f1f8e9,stroke:#558b2f


    style CallUnreserve fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px

    style LogoutConfirm fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style ExecuteLogout fill:#f1f8e9,stroke:#558b2f
    LoadInventory --> AddToInventory
    LoadInventory -->|Return| ActionScreen
    CombineDialog --> SubmitCombine
    CombineDialog -->|Return| ActionScreen
    SubmitCombine["Submit Combine to API"]
    SubmitCombine --> CombineDialog
    ReturnSubmit --> Refresh
    CallSelectWO --> Refresh
    StationLogin --> Refresh["Get Station Info"]
    CallUnreserve --> Refresh