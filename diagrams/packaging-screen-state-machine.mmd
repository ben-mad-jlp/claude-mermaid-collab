stateDiagram-v2
    [*] --> WorkorderSelection: App Start
    
    WorkorderSelection --> LoadingWorkorders: Station Selected\nloadWorkorders()
    LoadingWorkorders --> WorkorderSelection: ✓ Workorders Loaded
    LoadingWorkorders --> Error: ✗ Load Failed
    
    WorkorderSelection --> SelectingWorkorder: selectWorkorderWithServer()
    SelectingWorkorder --> ScanningContainers: ✓ Workorder Selected\n(scannedContainers reset)
    SelectingWorkorder --> Error: ✗ Selection Failed
    
    ScanningContainers --> LoadingContainer: loadSourceContainer()
    LoadingContainer --> ScanningContainers: ✓ Container Loaded\n(add to scannedContainers)\n(update totalPiecesAtStation)
    LoadingContainer --> Error: ✗ Load Failed
    
    ScanningContainers --> RefreshingStatus: refreshWorkingContainer()
    RefreshingStatus --> ScanningContainers: ✓ Status Updated
    RefreshingStatus --> Error: ✗ Refresh Failed
    
    ScanningContainers --> CreatingBox: createBox()\n(with actual piece count)
    CreatingBox --> UpdateProgress: ✓ Box Created\n(refresh working container)
    UpdateProgress --> ScanningContainers: Update Complete
    CreatingBox --> Error: ✗ Creation Failed
    
    ScanningContainers --> PackagingComplete: ✓ All Boxes Created\n(allBoxesComplete == true)
    
    PackagingComplete --> FinishingPackaging: Finish Packaging Clicked\nclearForNextWorkorder()
    FinishingPackaging --> WorkorderSelection: ✓ Ready for Next\n(load new workorder list)
    
    Error --> WorkorderSelection: clearError()\n(if no workorder selected)
    Error --> ScanningContainers: clearError()\n(if workorder active)
    Error --> PackagingComplete: clearError()\n(if packaging complete)
    
    WorkorderSelection --> LoggingOut: logoutFromStation()
    ScanningContainers --> LoggingOut: logoutFromStation()
    PackagingComplete --> LoggingOut: logoutFromStation()
    
    LoggingOut --> [*]: ✓ Logout Success\n(navigate to login)
    LoggingOut --> Error: ✗ Logout Failed
    
    note right of WorkorderSelection
        selectedWorkorder: null
        scannedContainers: []
        totalPiecesAtStation: 0
        Shows list of pending workorders
    end note
    
    note right of ScanningContainers
        selectedWorkorder: ✓ selected
        scannedContainers: [list]
        totalPiecesAtStation: ✓ current
        Scale reading visible
        Create Box button enabled
    end note
    
    note right of CreatingBox
        isLoading: true
        Creating packaged container
        API call in progress
    end note
    
    note right of PackagingComplete
        allBoxesComplete: true
        createdContainers: [list]
        Finish Packaging button enabled
    end note
    
    note right of Error
        error: ✓ message set
        Previous state context retained
        Shows error snackbar
    end note